---
published: true
---
## CKAN (Comprehensive Knowledge Archive Network)
  - 오픈데이터를 공개, 공유하는 데이터 포털 플랫폼
  - 비영리 단체인 OKI(Open Knowledge International) 산의 Open Knowledge Labs 에서 오픈 소스로 운영 중. 
  - GNU AGPL(Affero General Public License) 상업적 사용 자유
  - https://docs.ckan.org/
  - 2010년 영국 정부의 공공데이터 플랫폼으로 채택된 이후 각국의 공공데이터 플랫폼으로 활용되고 있으며, 국내에서는 서울의 열린데이터 광장에서 활용됨. 그 밖에 각종 국내의 공공 기관 데이터 플랫폼 구축 사업의 제안 요청서에 보면 거의 항상 언급되고 있음
  - 다른 블로그를 보면 데이터 플랫폼계의 하둡이라고 불리울만큼 거의 표준같은 느낌으로 취급되는 듯
  - 다른 CKAN 플랫폼 데이터 공유하는 기능을 제공하여 플랫폼 간 연계가 용이


## DCAT (Data Catalogue Vocabulary)
  - CKAN 에서의 데이터 색인을 위한 메타 데이터(데이터를 저장, 공유 체계)를 위하여 **DCAT**을 사용함
  - 쉬운 데이터 검색이 가능하고 RDF 형식임


## 도커기반 구축 환경
  - Ubuntu 18.04.4 LTS (ubuntu official docker image)
  - CKAN **2.9.0** : 버전에 따라 설치 방법이 다르니 필히 확인
  - Ubuntu official docker image : https://hub.docker.com/_/ubuntu
  - 시스템 및 포트 구성
   
    |service|port|used for|
    |----|--|---|
    |NGINX|80|Proxy|
    |Apache2|8080|Web Server|
    |Solr/Jetty|8983|Search|
    |PostgreSQL|5432|DB|
    |Redis|6379|Search|

## Docker 기반 Ubuntu 에서 설치하기 위한 기본 설정
  - systemd 를 활용해야하기 때문에 ubuntu 기본 이미지에 systemd 를 설치하고 다시 실행해야함
  - systemd 및 기타 명령어들 설치
  ~~~bash
  # 도커 컨테이너 안에서 실행
  apt update
  apt install -y systemd wget net-tools nano sudo
  ~~~
  - docker commit
  ~~~bash
  # 도커 컨테이너 밖에서 host OS 에서 이미지 생성
  docker commit [우분투 컨테이너] ubuntu-systemd:1804-0.1
  ~~~
  - Dockerfile 생성 : policy-rc.d 기능을 사용하기 위한 이미지생성
  ~~~bash
  # Dockerfile 생성하여 아래 설정 입력 후 저장
  FROM ubuntu:1804-systemd
  RUN echo "#!/bin/sh\nexit 0" > /usr/sbin/policy-rc.d
  ~~~
  - Dockerfile 빌드 
  ~~~bash
  docker build . --tag ubuntu-systemd:1804-0.2
  ~~~
  - docker run
  ~~~bash
  # systemd 를 활용할 수 있는 옵션들 추가한 컨테이너 생성
  # 내부 사용포트는 80 포트, 8983 포트를 사용할 것이며 테스트 용도로 외부로 포트포워딩함
  docker run -it -d --privileged --name handh-ckan -p 32080:80 -p 32983:8983 ubuntu-systemd:1804-0.2 /sbin/init
  ~~~

## CKAN 설치
  0. 상세 인스톨 페이지
  https://docs.ckan.org/en/2.8/maintaining/installing/install-from-package.html

  1. 관련 패키지 설치
  ~~~bash
  apt install -y libpq5 redis-server nginx supervisor
  ~~~
  
  2. CKAN 설치 
  ~~~bash
  wget http://packaging.ckan.org/python-ckan_2.9-bionic_amd64.deb
  dpkg -i python-ckan_2.9-bionic_amd64.deb
  ~~~
  
  3. PostgreSQL 설치
  ~~~bash
  apt install -y postgresql
  sudo service postgresql start # 서비스 시작이 안됐다면 실행
  sudo -u postgres psql -l # 설치 확인, UTF-8 인지 확인 필요
  sudo -u postgres createuser -S -D -R -P ckan_default # psql 계정 생성
  sudo -u postgres createdb -O ckan_default ckan_default -E utf-8 # DB 생성
  ~~~
  
  4. Solr 설치 및 설치
    - Solr : Apache Lucene 기반의 검색 플랫폼
    - 설치 명령어
    
     ~~~bash
     sudo apt install -y solr-tomcat
     ~~~
     
    - tomcat 포트 변경
    ~~~bash
    # /etc/tomcat9/server.xml 파일 내용수정
    <Connector port="8080" protocol="HTTP/1.1" 를
    <Connector port="8983" protocol="HTTP/1.1" 으로 수정
    ~~~
  
    - JAVA 설치 확인
    
  ~~~bash
  java --version # 설치 확인
  find \ -name java # 설치 경로 확인하여 아래 JAVA_HOME 에 넣어주기
  ~~~
  
    - CKAN 설정 변경
    
  ~~~bash
  sudo mv /etc/solr/conf/schema.xml /etc/solr/conf/schema.xml.bak
sudo ln -s /usr/lib/ckan/default/src/ckan/ckan/config/solr/schema.xml /etc/solr/conf/schema.xml
  ~~~
  
    - Jetty 서버 재시작
